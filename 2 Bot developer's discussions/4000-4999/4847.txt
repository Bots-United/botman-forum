--------------------------------------------------
Subject: bots won't load
--------------------------------------------------
09/24/03 at 13:25:44  Posted by: bigtoe (dale_hearn@msn.com)
--------------------------------------------------
I get this message after typing meta list in the consol.    
   description      stat pend  file              vers      src  load  unlod
          [ 1] Adminmod         RUN   -    admin_mm.dll      v2.50.56  ini  Start Start
          [ 2] HLGuard          RUN   -    hlguard_mm.dll    v1.50     ini  Chlvl Chlvl
          [ 3] STATSME          RUN   -    sm_cstrike_mm.dl  v2.7.1    ini  Chlvl Chlvl
          [ 4] <hpb_bot.dll>    badf load  hpb_bot.dll       v -       ini   -     -   
         4 plugins, 3 running
what can i do to fix. Installed all file just like they were put into my cs directory. I put the game dll/hpb_bot.dll in in meta list. that is the only thing differant.

[modified on 09/24/03 at 13:25:44]
--------------------------------------------------
09/24/03 at 14:17:33  Reply by: botman (botman@planethalflife.com)
--------------------------------------------------
Are you using the "+localinfo" command line option when starting the server to get metamod to load the HPB bot DLL?  (it's not a plugin, so you can't put it in the metamod.ini file).

See this thread...

http://dynamic.gamespy.com/~botman/yabb/YaBB.pl?board=1&action=display&num=4381

botman

--------------------------------------------------
09/24/03 at 22:58:45  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
On my server (linux steam), I am loading metamod (localinfo done with autoexec.cfg) and whenever I have the HPB_Bot_i486.so file loading it crashes the server....Do I need to recompile the source or is there a greater problem for us Unix guys?

--------------------------------------------------
09/24/03 at 23:49:47  Reply by: bigtoe (dale_hearn@msn.com)
--------------------------------------------------
ok I did all this,

localinfo mm_gamedll "addons/hpb_bot/dlls/hpb_bot.dll" 

in a file called "autoexec.cfg" in your server root folder 
 and my server wont start with it in there. What could I be doing wrong?

--------------------------------------------------
09/25/03 at 00:56:41  Reply by: bigtoe (dale_hearn@msn.com)
--------------------------------------------------
ok I got the hpb 3.0 finally.I installed and the server is running. I use command addbot in rcon and nothing happens. I do have waypoint installed into the map folder I hope it is right. 

[modified on 09/25/03 at 00:56:41]
--------------------------------------------------
09/25/03 at 05:23:26  Reply by: botman (botman@planethalflife.com)
--------------------------------------------------
You'll need to use the HPB_bot CVAR to add bots via rcon.  See this thread...

http://dynamic.gamespy.com/~botman/yabb/YaBB.pl?board=1&action=display&num=2901

botman

--------------------------------------------------
09/25/03 at 23:04:05  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
I understand that the directory structure is different....Under windows.  But what about linux.....that keeps getting overlooked.  There are a few people on the steam forum with the same problem.  I think that the windows version still works, but there is something wrong with the linux version.  I have everything configured as it was pre-steam.  I have changed my liblist.gam back to use metamod and am using localinfo to load the bots....

--------------------------------------------------
09/26/03 at 05:49:08  Reply by: botman (botman@planethalflife.com)
--------------------------------------------------
How far does it get before crashing the Linux dedicated server?

Do you get any output or error messages when it crashes?  If so, what are they?

You're going to need to be a little more specific.

botman

--------------------------------------------------
09/26/03 at 18:39:36  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
i'm not seeing an error on the console......It starts to add the first bot and then the server spontaneously restarts....

L 09/26/2003 - 20:38:06: World triggered "Round_Start"
min_bots set to 2
max_bots set to 20
Creating HPB bot...
Segmentation fault (core dumped)
cat: hlds.725.pid: No such file or directory
Deprecated bfd_read called at /usr/src/gnu/usr.bin/binutils/gdb/../../../../contrib/gdb/gdb/dbxread.c line 2627 in elfstab_build_psymtabs
Deprecated bfd_read called at /usr/src/gnu/usr.bin/binutils/gdb/../../../../contrib/gdb/gdb/dbxread.c line 933 in fill_symbuf
/lib/libNoVersion.so.1: No such file or directory.
email debug.log to linux@valvesoftware.com
Fri Sep 26 20:38:41 CDT 2003: Server restart in 10 seconds

i also have debug.log if that will help.

thanks,
stinkybob

--------------------------------------------------
09/26/03 at 19:52:24  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
i've fixed the deprecated bfd_read problems and the /lib/libwhatever.so error.....

it is still crashing though after the first bot adds..

--------------------------------------------------
09/26/03 at 23:57:16  Reply by: bigtoe (dale_hearn@msn.com)
--------------------------------------------------
Ok I messed around with the bots my my win server and they still won't load. I contacted the server peeps and they said to me that cs 1.6 will not except any bot codes until the new server upgrade comes out around the 1st of OCT.

[modified on 09/26/03 at 23:56:44]

[modified on 09/26/03 at 23:57:16]
--------------------------------------------------
09/27/03 at 06:46:55  Reply by: botman (botman@planethalflife.com)
--------------------------------------------------
Stinky, make SURE you have 'HPB_bot_names.txt' and 'HPB_bot_chat.txt' files in the MOD directory (i.e. hlds_l/tfc or hlds_l/cstrike, etc).  If these 2 text files don't exist in the MOD directory, the HPB bot will crash.

If you have gdb installed on your Linux server, you can run it to print out what caused the crash.  Wait for the core dump to finish getting written to disk then do...

gdb hlds core

...in the hlds_l directory and when the gdb prompt comes up, enter "where" (or "traceback") to print the stack traceback information which should tell what functions in the code lead up to the crash.

botman

--------------------------------------------------
09/27/03 at 13:26:20  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
i'll try doing th gdb thing.  Everything worked perfect until I installed steam for linux.....i've been using your bots for quite a while.  Everything has been great until steam came along...At least it's easier to find online servers to play on now (steam helped with that).  i'll post my results of the core dump in an hour or so...(gotta go to work now)

--------------------------------------------------
09/27/03 at 14:07:14  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
there were a lot of file not found errors listed from gdb.....i'll attempt to fix those.  here is the output from the "where" command.

(gdb) where
#0  0x00000000 in ?? ()
#1  0x2b639927 in ?? ()
Cannot access memory at address 0xc9f4



--------------------------------------------------
09/27/03 at 14:09:25  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
nevermind the last post....that was a dump pre-steam.  to read my dump i had to do "gdb hlds_i686 hlds_i686.core"

here is the output

(gdb) where
#0  0x00000000 in ?? ()
#1  0x2bac12d9 in CBaseBot::BotThink () from cstrike/dlls/cs_i386.so
#2  0x2baa385b in CCSBotControl::BotControlThink () from cstrike/dlls/cs_i386.so
#3  0x2bac2014 in CBaseBotControl::StartFrame () from cstrike/dlls/cs_i386.so
#4  0x2ba1f4cc in StartFrame () from cstrike/dlls/cs_i386.so
#5  0x2b94b3cb in StartFrame () from /usr2/hlds_l/cstrike/dlls/HPB_bot_i486.so
#6  0x2b84a6fa in mm_StartFrame () from ./cstrike/addons/metamod/dlls/metamod_i386.so


--------------------------------------------------
09/27/03 at 14:59:29  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
here's where it crashes when not using metamod.

(gdb) where
#0  0x00000000 in ?? ()
#1  0x2b9a12f9 in CBaseBot::BotThink () from cstrike/dlls/cs_i386.so
#2  0x2b98387b in CCSBotControl::BotControlThink () from cstrike/dlls/cs_i386.so
#3  0x2b9a2034 in CBaseBotControl::StartFrame () from cstrike/dlls/cs_i386.so
#4  0x2b8ff4ec in StartFrame () from cstrike/dlls/cs_i386.so
#5  0x2b82b3cb in StartFrame () from ./cstrike/dlls/HPB_i386.so
#6  0x282e2332 in SV_Physics () from /usr2/hlds_l/engine_i686.so
Cannot access memory at address 0xa


--------------------------------------------------
09/28/03 at 04:37:35  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
LOL!!!!!!!

Hey guys, looks like Michael Booth's official bots don't like when third-party bots are added!!!
The trace dump means that there is a conflict between the HPB_bot and the "supposedly disabled" official CS bots code... I suspect that to "disable" the official bots, they just commented out the line that creates the bot, while all the other code is still running... hence when the HPB_bot creates its own bot, the CS bot code stupidly believes it's one of his, and tries to access its data...

mamma mia, does this means we won't ever be able to use bots in CS ***OTHER*** than the official bots ???

botmaaaaaaaaaaaaaaaaaaaaannnnn heeeeeeeeeeeeeeeeeellllpppppp

--------------------------------------------------
09/28/03 at 07:40:24  Reply by: botman (botman@planethalflife.com)
--------------------------------------------------
Yes, the 'CBaseBot' part is definitely the "Official Counter-Strike Bot" code (which was apparently only partialy disabled).

The only way that I can think of to get bots to work with the Steam version of Counter-Strike is to use my BotMixer5000 program to load a non-Offical Counter-Strike bot.

I haven't tested the BotMixer5000 with the Steam version of Half-Life/Counter-Strike/TFC/etc., so you may have to try it and see if it works or not.  The installation procedure will be different than the BotMixer5000 install batch file expects, so you may have to manually copy the files that the batch file would have copied.

Here's what you need to try...

1. Copy BotMixer5000_i486.so into the cstrike dlls directory (I'm not sure where this is for Steam Linux CS, for Windows it's Steam\SteamApps\counter-strike\cstrike\dlls).

2. Rename the cs_i386.so to cs_botmixer_i386.so

3. Copy fakedll_i486.so into the CS dlls directory and name it cs_i386.so

4. Copy botmixer5000.cfg to the cstrike directory (one directory above the 'dlls' directory)

5. Rename cstrike/liblist.gam to liblist.bak (so you have a backup copy in case you have to go undo everything).

6. Copy the liblist.gam file in the BotMixer5000/cstrike folder into the cstrike folder (to replace the previous liblist.gam file).

7. Edit the liblist.gam file with any text editor (vi?) and change the "gamedll_linux" entry to point to the BotMixer5000_i486.so file that you copied into the cstrike/dlls directory (you may have to experiment with the path name, but try "cstrike/dlls/BotMixer5000_i486.so" or "counter-strike/cstrike/dlls/BotMixer5000_i486.so" in addition to the default value of "dlls/BotMixer5000_i486.so" to see if any of those work)

botman

--------------------------------------------------
09/28/03 at 15:02:13  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
that was a great idea....so far no luck though.

BotMixer5000 - Error determining MOD directory name!

i'm going to try it using localinfo through metamod and see what happens..

Stinky

--------------------------------------------------
09/28/03 at 15:06:45  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
it pulls the same error when loaded through metamod.  hmmmm....this is kinda frustrating.  but at least i love a challenge....and your help has been awesome, botman.

Stinky

--------------------------------------------------
09/28/03 at 16:31:47  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
Couldn't someone just ask of Valve that they manage their bots better ?

So far, looks like their bot code is assuming that any entity that has the FL_FAKECLIENT flag set is an official bot ; hell this is not true!

I wonder actually... what if we used ANOTHER bit as FL_FAKECLIENT in our OWN bot code ? (such as FL_MONSTER, or why not define another unused bit). We would then refer to our bots using that bit and only it...

I don't have Steam installed, being between a 24k modem, so I can't test.... but I would build a modified version of the HPB_bot, replacing FL_FAKECLIENT by another bit !

Hell this is a challenge I would love to take :D


--------------------------------------------------
09/29/03 at 01:11:37  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
This is so funny. I just read the trace dump and this thread.

I was about to post in here the theory that the 1.6 CS bots were the cause of the problem, ie the crash was due to the improper disabling of the CS Bots, now this seems to confirm it!

Nice idea PMB, I'll give your suggestion a try tomorrow if I find the time. It is possible that the CS Bots (even in enabled form) will not like 3rd party bots unless we can somehow make them unidentifiable as bots.

* edit *

Using the simple addbot code I posted previously, I tried with FL_FAKECLIENT set 0, and FL_MONSTER set 1 - same crash. I also tried with FL_SPECTATOR set but same crash again. 

It is still possible the CS Bots are identifying a bot using the "authid = 0" or some other method so more tests can be done.

It's getting late so that's all I will do for tonight.

[modified on 09/29/03 at 01:04:36]

* edit *

One other thing, perhaps we can get away with simply not executing the mp.dll "think" function?

[modified on 09/29/03 at 01:11:37]
--------------------------------------------------
09/29/03 at 08:24:27  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
Could someone post this info to the steam forum?  I've tried to post to it but apparantly I dont have "access" to do so.......and their admins never check their emails to reset my forum perms.

Stinky

--------------------------------------------------
09/29/03 at 08:52:19  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
Another explanation, official bots are "defined" as such in the CreateFakeClient() function directly... if so, we're deeply in the crap.


--------------------------------------------------
09/29/03 at 11:08:06  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
That would mean they modified the hl engine which I think would be unlikely since the bots are mod specific. However, if you wanted to prevent 3rd party bots from invading a solo user game, then that would be one way to enforce it. 

I'll disable mp.dll from executing the think function to see what happens.

*edit*

Disabling pfnThink did not help. 

[modified on 09/29/03 at 11:08:06]
--------------------------------------------------
09/29/03 at 11:47:34  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
no, it won't help Rob because the official bots seem to be hooked upon StartFrame(), ala botman.

One can't just prevent StartFrame() to run, eh? :(

darn I wish I had that freakin POS^H^H^Hsteam to run tests too

On a sidenote, are you 100% certain of your addbot code ?

If yes, try this as they're the ideas that are currently popping up in my mind:
-Return a random string in GetPlayerAuthId() for bots
-Return a random integer in GetPlayerWONId() for bots
-Make them connect with something different from "127.0.0.1" as the client address (another 127.x.y.z class address will be fine, that's the method I use with my bots to differentiate them from a real loopback client I sometimes use for testing)
-Fill in the WHOLE infobuffer like the one of a player before PuttingItInServer().

argh, running out of ideas. crap.


--------------------------------------------------
09/29/03 at 14:01:13  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
"On a sidenote, are you 100% certain of your addbot code ? "

99% since it was a long time ago since I used this code to add a bot. I'll do a test from the CS 1.5 version to be certain.

"If yes, try this as they're the ideas that are currently popping up in my mind: 
-Return a random string in GetPlayerAuthId() for bots "

Did this but it did not help.

"-Return a random integer in GetPlayerWONId() for bots"

Did not try this since I assume the bot code uses GetPlayerAuthId(), but should try it just in case.
 
"-Make them connect with something different from "127.0.0.1" as the client address (another 127.x.y.z class address will be fine, that's the method I use with my bots to differentiate them from a real loopback client I sometimes use for testing)"

Good idea, will try.

"-Fill in the WHOLE infobuffer like the one of a player before PuttingItInServer(). "

Can you give me an example of this?

--------------------------------------------------
09/29/03 at 14:08:53  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
AHHH CRAP!

I was doing *all* my testing with the WRONG code! What I changed never got executed, instead the original version was being run. Damn the perils of hacking. 

I'll repeat all my tests again ...

--------------------------------------------------
09/29/03 at 14:32:05  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
WHOO HOOO!

Setting the bit flag to FL_MONSTER worked!

This is what it appears, but I still have to do more tests to make sure it continues to work as more is done to the bot.


--------------------------------------------------
09/29/03 at 14:58:38  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
code:

YY  YY EEEEEE EEEEEE     HH  HH  AAAA  WW  WW  !!  !!  !!
YY  YY EE     EE         HH  HH AA  AA WW  WW  !!  !!  !!
 YYYY  EEEE   EEEE   --- HHHHHH AAAAAA WWWWWW  !!  !!  !!
  YY   EE     EE         HH  HH AA  AA WWWWWW
  YY   EEEEEE EEEEEE     HH  HH AA  AA  W  W   !!  !!  !!


YEAH!
I was sure that could work ;D
Anyway Rob, now we should perhaps better define a new flag for third-party bots, one that is not used yet in the integer bitmap.

The show goes on!!!
8)



--------------------------------------------------
09/29/03 at 16:13:43  Reply by: botman (botman@planethalflife.com)
--------------------------------------------------
If you don't set the FL_FAKECLIENT bit on a FL_CLIENT entity, the engine will try to send network messages to that client and should crash with the "sz_getspace: tried to write to an uninitialized sizebuf_t" error message.

Are you saying you set FL_MONSTER instead of FL_FAKECLIENT (while also having FL_CLIENT set)?

botman

--------------------------------------------------
09/29/03 at 17:58:25  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
I think I'm in heaven!!!!  I set every entry to FL_MONSTER instead of FL_FAKECLIENT and recompiled the code (with the metamod changes)...and now I have bots again!!!

let's see if they run stable.

thanks for all the help everyone.

Stinky

--------------------------------------------------
09/29/03 at 18:53:03  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
well...i'm using PMB's metamod HPB code (I couldn't get the original v3 source to go).  I had to add stdio.h and string.h to the cpp files to get them to compile and change the Makefile to use g++ instead of gcc.  after figuring all that out, I've got metamod compatible, steam CS1.6 bots.  So far they haven't crashed my server either.  running well.  they still pick teams and everything.

Stinky
ps.....again, thanks for all the great help.
if anyone wants a copy of my binary (linux) let me know.

--------------------------------------------------
09/29/03 at 20:05:02  Reply by: sgtpain (sgtpain@shaw.ca)
--------------------------------------------------
 Thanks for the great work. Would love to have a copy of the binary Stinkybob. Finally some working bots for cs 1.6. Yeah 


[modified on 09/29/03 at 20:03:44]

[modified on 09/29/03 at 20:05:02]
--------------------------------------------------
09/29/03 at 21:09:01  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
Before calling pfnClientConnect I set the fake client bit. I assumed that would be safest for the connection. After that, I called pfnClientPutInServer. Immediately after the pfnClientPutInServer call I cleared the fake client bit amd set the FL_MONSTER bit. 

At no point did I do anything with FL_CLIENT so I assume it remained cleared.

At this point I'm still working on getting my bot to join the game. Currently it floats around as a spectator. However Stinkybob seems to of already had full success with the technique.

Nice job everyone!



[modified on 09/29/03 at 21:09:01]
--------------------------------------------------
09/29/03 at 23:07:31  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
QUOTE:
If you don't set the FL_FAKECLIENT bit on a FL_CLIENT entity, the engine will try to send network messages to that client and should crash with the "sz_getspace: tried to write to an uninitialized sizebuf_t" error message.

Are you saying you set FL_MONSTER instead of FL_FAKECLIENT (while also having FL_CLIENT set)?



Yeah, but we have already enough checks in the code to prevent this, don't we ?


--------------------------------------------------
09/30/03 at 00:14:36  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
I've finally managed to get my own bots into the CS 1.6 game. They don't navigate yet but they will aim and shoot the enemy very well. I ran several tests and it appears to be stable.

I think it is time that we decide on what bit to use as our standard for 3rd party bots.


--------------------------------------------------
09/30/03 at 03:46:39  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
I have already changed mine...

Since flags is an int (32-bit wide) and that only bits 1 to 16 are used, I suggest we use the 1st bit of the 3rd byte.


#define FL_THIRDPARTYBOT (1 << 17)


I am running 2 dedicated servers for hours since yesterday with RACC using this bit ; no trouble so far. Everything works as good as before. [Edited: have to mention that it's HL 1.1.1.0 and CS 1.5, not 1.6 since I don't have Steam. I also run TFC and Opposing Force. But at least it proves that the engine strictly doesn't care about the FL_FAKECLIENT bit being set or not]

[modified on 09/30/03 at 03:46:39]
--------------------------------------------------
09/30/03 at 07:36:09  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
http://www.geocities.com/evanandfaith/hpbbotlinux.zip

[modified on 09/30/03 at 07:36:09]
--------------------------------------------------
09/30/03 at 09:11:31  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
PMB email me your address and I'll have a CD with the steam cache sent to you by snail mail :)

BTW, what's with the all LEET SPEAK !!!
Pierre-Marie Baty
Member 
Posts: 1337 

[modified on 09/30/03 at 09:11:31]
--------------------------------------------------
09/30/03 at 12:16:59  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
hey thanks, you should have got it now.

w00t I'm l33t, champagne! but crap I'm forced not to post if I want to remain l33t, isn't there no way to freeze the post count ? darn ;D


--------------------------------------------------
09/30/03 at 12:31:52  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
QUOTE:
Since flags is an int (32-bit wide) and that only bits 1 to 16 are used, I suggest we use the 1st bit of the 3rd byte. 



Would it not be safest to use the last bit of the 4th byte? 

Generally, the use of the bits will start at the lsb up to the msb. Since we're hacking away at someone else's code, then we should consume bits in the opposite direction.


--------------------------------------------------
09/30/03 at 14:01:24  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
Not a problem for me (even if it looks less natural at first, but whatever). others, what do you think ?


[modified on 09/30/03 at 14:01:24]
--------------------------------------------------
09/30/03 at 14:09:10  Reply by: botman (botman@planethalflife.com)
--------------------------------------------------
You could probably use any bit you want since bot authors don't necessarily have to agree on what's used.  If it were me, I'd pick the 30th bits (2nd from the top) and use it, since using the 31st bit would make the number negative (don't know if that would cause any problems anywhere or not).

Since most people aren't going to run more than one bot at a time, it shouldn't matter what other people are using.

I'm still surprised that the engine won't crash with messages being sent to clients who don't have the FL_FAKECLIENT bit set.

Has anybody who's changed this tried running any metamod plugins that send stuff to the client when bots are running on the server (like custom welcome messages, etc)?  I would assume when a bot joins the server, the metamod plugin would try to send a message to the bot's client and the engine wouldn't prevent this because the FL_FAKECLIENT bit wasn't set.  This should lead to the "tried to write to unitialized sizebuf_t" error (and a crash).

botman

--------------------------------------------------
09/30/03 at 16:56:08  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
There's something I haven't fully understood either here. Does the engine REALLY do this ?

I remember the need to patch pfnClientCommand() and pfnClientPrintf() calls, *precisely* to prevent the engine to send client messages to bots. If these hooks weren't set, the game crashed, automatically. To me, that means the engine doesn't check anything at all ; and it's in charge of the bot coder to do so.

The comment near the FL_FAKECLIENT definition is curious too: "don't send network messages to them". Does this mean that the engine genuinely DOES NOT send network message to bots, running the appropriate checks ? To me it sounds rather like an advice to the programmer: "if you use this flag, DON'T send network messages to them".

My bots never crashed, ever, because of a bad network message, since the date where I put the pfnClientCommand() (server-sided client command) and pfnClientPrintf() hooks in place. I even restored the pfnClientCommand() normal functionality for bots, but without using network messages.

Weren't these fixes already in the HPB_bot ? I'm not sure I understand why you would want the engine to crash. The only way it could be caused would be through a metamod plugin (which is loaded AFTER the HPB_bot hook DLL). But my bot DLL automatically loads metamod first, before opening the gamdll, so this problem doesn't concern me ; it doesn't concern those whose bots are metamod plugins either, provided the fixes are in.

[edit: doesn't this thread belong to the developers forum, rather ?]

[modified on 09/30/03 at 16:56:08]
--------------------------------------------------
09/30/03 at 17:13:13  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
Wee, I was too fast, look
code:

// Constants shared by the engine and dlls
// This header file included by engine files and DLL files.
// Most came from server.h

// edict->flags
#define      FL_FLY                              (1<<0)      // Changes the SV_Movestep() behavior to not need to be on ground
#define      FL_SWIM                              (1<<1)      // Changes the SV_Movestep() behavior to not need to be on ground (but stay in water)
#define      FL_CONVEYOR                        (1<<2)
#define      FL_CLIENT                        (1<<3)
#define      FL_INWATER                        (1<<4)
#define      FL_MONSTER                        (1<<5)
#define      FL_GODMODE                        (1<<6)
#define      FL_NOTARGET                        (1<<7)
#define      FL_SKIPLOCALHOST            (1<<8)      // Don't send entity to local host, it's predicting this entity itself
#define      FL_ONGROUND                        (1<<9)      // At rest / on the ground
#define      FL_PARTIALGROUND            (1<<10)      // not all corners are valid
#define      FL_WATERJUMP                  (1<<11)      // player jumping out of water
#define FL_FROZEN                        (1<<12) // Player is frozen for 3rd person camera
#define FL_FAKECLIENT                  (1<<13)      // JAC: fake client, simulated server side; don't send network messages to them
#define FL_DUCKING                        (1<<14)      // Player flag -- Player is fully crouched
#define FL_FLOAT                        (1<<15)      // Apply floating force to this entity when in water
#define FL_GRAPHED                        (1<<16) // worldgraph has this ent listed as something that blocks a connection

// UNDONE: Do we need these?
#define FL_IMMUNE_WATER                  (1<<17)
#define      FL_IMMUNE_SLIME                  (1<<18)
#define FL_IMMUNE_LAVA                  (1<<19)

#define FL_PROXY                        (1<<20)      // This is a spectator proxy
#define FL_ALWAYSTHINK                  (1<<21)      // Brush model flag -- call think every frame regardless of nextthink - ltime (for constantly changing velocity/path)
#define FL_BASEVELOCITY                  (1<<22)      // Base velocity has been applied this frame (used to convert base velocity into momentum)
#define FL_MONSTERCLIP                  (1<<23)      // Only collide in with monsters who have FL_MONSTERCLIP set
#define FL_ONTRAIN                        (1<<24) // Player is _controlling_ a train, so movement commands should be ignored on client during prediction.
#define FL_WORLDBRUSH                  (1<<25)      // Not moveable/removeable brush entity (really part of the world, but represented as an entity for transparency or something)
#define FL_SPECTATOR            (1<<26) // This client is a spectator, don't run touch functions, etc.
#define FL_CUSTOMENTITY                  (1<<29)      // This is a custom entity
#define FL_KILLME                        (1<<30)      // This entity is marked for death -- This allows the engine to kill ents at the appropriate time
#define FL_DORMANT                        (1<<31)      // Entity is dormant, no updates to client


crapcrapcrap, all the bits are used finally! I thought it was just the first block, but I hadn't scrolled the page down to the bottom.

The bits 17, 18 and 19 look like they are unused. I would feel more comfortable using one of those since using FL_MONSTER or any other one could induce the engine in error regarding the way it deals with these entities (it does probably do weird stuff with monsters, actually).

[Edit: what's this one: FL_CUSTOMENTITY ??]

[modified on 09/30/03 at 17:13:13]
--------------------------------------------------
09/30/03 at 21:01:32  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
Bits 27 & 28 are not listed so perhaps they are unused?

As for messages to fake clients crashing the server, I've never paid much attention to this since I never had related problems.



--------------------------------------------------
10/01/03 at 00:58:43  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
I just noticed that when a bot is dropped on map change, a message appears saying something like the "fakeclient was dropped". This is happening even though the fakeclient bit is not set. So it seems that tha HL engine knows that the bots are fake clients no matter if the bit is set of not. 

*edit*

Also noticed that the steam id for a bot is always "BOT" no matter what the fakeclient bit is set to, so it seems that we don't need to set a flag bit to identify which players are bots.

[modified on 10/01/03 at 00:58:43]
--------------------------------------------------
10/01/03 at 03:36:34  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
They are probably recorded internally in pfnCreateFakeClient().

Okay for bits 27 or 28, didn't notice them :)


--------------------------------------------------
10/01/03 at 04:53:41  Reply by: K1dS3ns4t10n! (evdev2000@yahoo.com)
--------------------------------------------------
QUOTE:
http://www.geocities.com/evanandfaith/hpbbotlinux.zip

[modified on 09/30/03 at 07:36:09]




This link isn't working for me.. I'd like to try Stinkybob's binary out on my steam server.. anyone have a mirror of this file set up? 

[modified on 10/01/03 at 04:53:41]
--------------------------------------------------
10/01/03 at 05:40:42  Reply by: botman (botman@planethalflife.com)
--------------------------------------------------
Okay, I finally went and looked at the latest copy of the Half-Life engine code that I have access to (from Condition Zero a few months before Gearbox stopped working on it).

In the engine's pfnCreateFakeClient() function, the engine DOES keep an internal flag (not part of the edict_s structure) that indicates which edicts are fake clients...

code:
    // Set up client structure.
    Q_strncpy( fakeclient->name, netname, 32 );
    fakeclient->active = true;
    fakeclient->spawned = true;
    fakeclient->fully_connected = true;
    fakeclient->connected = true;
    fakeclient->uploading = false;
    fakeclient->edict = ent;
    fakeclient->fakeclient = true;

...see the last line above.  So for all future engine calls, the engine can safely ignore the edict->flags FL_FAKECLIENT bit (which USED to be needed in the old days for bots) and just check this internal engine table to see if the edict has the "fakeclient" field set to 'true' or 'false'.

However, the pfnMessageEnd() function has this...
code:
void DLL_CALLBACK PF_MessageEnd_I( void )
{
    qboolean      MsgIsVarLength = false;
    sizebuf_t      *pBuffer;
    int                  entnum;

    if (!gMsgStarted)
          Sys_Error( "MESSAGE_END called with no active message\n" );

    gMsgStarted = false;

    if ( gMsgEntity && gMsgEntity->v.flags & FL_FAKECLIENT )
          return;            // throw away the message;  it's not a real client

It DOES NOT check the above mentioned list of internal engine clients to see if the 'fakeclient' field is true, but relies on the FL_FAKECLIENT bit being set in the edict 'flags' field.

The ONLY other place in the engine code where FL_FAKECLIENT is checked is in the pfnGetAimVector() function used by autoaiming to help players aim at monsters, players, and/or bots.

So, FL_FAKECLIENT shouldn't be needed to be set in your bot edict EXCEPT in the cases where pfnMessageEnd() is called.  If you can intercept pfnMessageEnd() between the game DLL, all metamod plugin DLLS, and all bot DLLs, and set this bit whenever a message is sent to a bot, that should prevent the "tried to write to uninitialized sizebuf_t" error.  If you don't do this, I don't see how you can prevent the engine from having problems when network messages are sent to bot entities.

Of course, the Half-Life engine may have changed between now and the latest version of code that I have (the copy I have access to is over a year old).  The Steam engine may handle this differently.  It should be easy enough to test.  Create a bot, clear the FL_FAKECLIENT bit (the engine WILL set it for you even if you don't set it when you call pfnCreateFakeClient), then try to send network message to that bot.  When the pfnMessageEnd() function is called, the engine should crash (if the engine code is still the same).

If you want to continue this discussion, perhaps a new thread should be started in the "Bot Developers" section.

botman

--------------------------------------------------
10/01/03 at 06:56:49  Reply by: sgtpain (sgtpain@shaw.ca)
--------------------------------------------------
Mike, Try right click and save target as. Also run under metamod.

--------------------------------------------------
10/01/03 at 08:47:42  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
QUOTE:
clear the FL_FAKECLIENT bit (the engine WILL set it for you even if you don't set it when you call pfnCreateFakeClient)


umm, I beg to disagree: it doesn't...

I have a metamod plugin of mine which dumps any entity's entvars and resolves every bitmask, string pointers and enum types. My bots are running and shooting together for hours and none has the FL_FAKECLIENT flag.


[edit]to botman: as for beginning a new thread in the bot developers' section, why not just move this one ? There are really worthy info in it and some bot developers might not have the idea to check elsewhere out of the bot devs' forum.

[modified on 10/01/03 at 08:47:42]
--------------------------------------------------
10/01/03 at 11:40:34  Reply by: botman (botman@planethalflife.com)
--------------------------------------------------
The engine code for pfnCreateFakeClient() does this in the copy that I currently have...
code:
    ent->v.flags = FL_CLIENT <bar here> FL_FAKECLIENT;

So it should be setting FL_CLIENT and FL_FAKECLIENT on an entity created using pfnCreateFakeClient().  I haven't verified that this still works, so the current standalone Half-Life engine may have a different behavior and the Steam client engine may have yet another behavior.  You'd have to try it for yourself to find out for sure.

botman

[modified on 10/01/03 at 11:40:34]
--------------------------------------------------
10/01/03 at 12:06:41  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
I think i've run into a slight hitch....On my server, it seems to ignore the max_bots variable....i looked this morning and there were 30 bots running...  I work around it by disabling the min and max and by adding a static amount of bots..

Stinky

--------------------------------------------------
10/02/03 at 00:34:22  Reply by: OffTopic (khomsan.ph@student.chula.ac.th)
--------------------------------------------------
Have got the stream cs1.6 yet, i'm still using cs1.5.

So the official csbot doesn't fully disable and it use the FL_FAKECLIENT flags in the way that prevent the other bots from working correctly? does my understanding is correct? if so then IMHO we have to know how the official csbot working with the FL_FAKECLIENT flags? or it's simply assume that all the client with FL_FAKECLIENT is the official csbot?

i have no more idea...

--------------------------------------------------
10/02/03 at 03:51:04  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
Your 2nd option is the correct one. The problem is that the official bot code assumes that EVERY entity which has the FL_FAKECLIENT flag set is one of its bots, and it attempts to take control of it, even if it's a third-party bot. That's why we have to use another way to flag our bots, else the CS bot code will crash the engine.

@botman: which version is the engine you have ?


[modified on 10/02/03 at 03:51:04]
--------------------------------------------------
10/02/03 at 05:38:28  Reply by: botman (botman@planethalflife.com)
--------------------------------------------------
"botman: which version is the engine you have ?"

I'm not completely sure, I believe it's the 1.0.0.2 Version of Counter-Strike, which I believe matches the 1.1.0.8 version of the Half-Life engine.

--------------------------------------------------
10/02/03 at 11:20:09  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
QUOTE:
Your 2nd option is the correct one. The problem is that the official bot code assumes that EVERY entity which has the FL_FAKECLIENT flag set is one of its bots, and it attempts to take control of it, even if it's a third-party bot. That's why we have to use another way to flag our bots, else the CS bot code will crash the engine.



I looks like the flag we can use is the same FL_FAKECLIENT. 

Here's how in pseudocode:

IF IsNotSet( FL_FAKECLIENT ) AND ( AuthId == "BOT" ) THEN Entity is a 3rdPartyBot

I'm using this method and it works well. I have bots on my cs 1.6 server with human players for the last couple of days and so far so good.


--------------------------------------------------
10/02/03 at 15:22:12  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
hmm yes, but I prefer using a bit flag though. Calling pfnGetAuthId() takes time, more than that it returns a string, and think that if you check bots this way it's a function you'll have to call 50 or 60 times per frame. Definitely a bit flag for me.

if (pBot->pEntity->v.flags & FL_THIRDPARTYBOT)

much faster :)


--------------------------------------------------
10/02/03 at 15:41:40  Reply by: botmeister (meister@telus.net)
--------------------------------------------------
QUOTE:
it's a function you'll have to call 50 or 60 times per frame. Definitely a bit flag for me.




Yes very true, however the need to determine what is a bot or not does not have to be made on each frame. 

I'll explain ...

The general problem anyone will have with using v.flag is that for some reason the flag gets reset after each frame rendering it useless as a means to keep track of bots by itself. For example botmans template does not actually use the flag to decide what is a bot. I think the only reason for setting the status flag was when this had to be done to prevent a server crash. Since the server does not crash anymore, you may as well store your own bit flag in your list of bots (I assume you use a list to track your bots) rather than continually reseting the status flag while cycling through your list of bots. 

One more thing, if you are making a game independant bot, then you'll want to isolate your code as much as possible from the details of the using bit flags stored in some game specifc structure.

[modified on 10/02/03 at 15:41:40]
--------------------------------------------------
10/02/03 at 16:47:44  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
Indeed, that's why I don't care about this flag, since the engine doesn't seem to set it, contrarily to what botman was saying. That's why I don't need to "reset it". Safe for me.

I'm using my own flag, but sure I could as well put it elsewhere... in my players structure or wherever.

Cigarette break. Need one tonight.


--------------------------------------------------
10/06/03 at 13:57:42  Reply by: DiVeBoMbeR (free_fall@attbi.com)
--------------------------------------------------

QUOTE:
I think i've run into a slight hitch....On my server, it seems to ignore the max_bots variable....i looked this morning and there were 30 bots running...  I work around it by disabling the min and max and by adding a static amount of bots..

Stinky




I have this problem too, anyone find a fix?
Thanks :)

--------------------------------------------------
10/07/03 at 04:05:33  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
Yes, move the bot count increase and decrease respectively in ClientPutInServer() and ClientDisconnect(). Everyone should do this.


--------------------------------------------------
10/07/03 at 09:22:00  Reply by: DiVeBoMbeR (free_fall@attbi.com)
--------------------------------------------------
ummm, ok
I couldn't code my way out of a paper bag :(
I can however copy and paste if I know what and where the code is. <hint>
:)
me=nOOb
Thanks

--------------------------------------------------
10/09/03 at 01:39:59  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Hello all, I was wondering if I could get some help here. I have been hacking at this for hours upon hours today, following these forums and many other places all over the web. I am beginning to understand why the bots dont work now, so I grabbed StinkyBob's modified .so file there, and I put that in my liblist.gam. The error I am getting now, is shared library missing, something about LIBSTDC++.SO.5 not being there. Now I am running CS1.6 with steam on FreeBSD 4.9 with linux emulation. FreeBSD has no problem running this server under its excellent linux emulation.. I ran CS1.3-1.5 very well, WITH HPB_bot as well as adminmod installed. Although I do remember needing a hacked metamod.so file for FreeBSD then as well.. The problem at hand is StinkyBob compiled that .so on linux. I am s00o close now I would hate to give up at this point because theres a bunch of other boundaries I had to cross to even get this far that I didnt mention here. (no need to cause I passed them heh.) Does anyone have any idea what I can do to get LIBSTDC++.SO.5 on my FreeBSD system? I looked through the ports collection in devel/ and I installed a few different sets of libraries but it didnt help me. Maybe you can lead me into how I can do what StinkyBob did which was compile it on his own, and I can just do that on FreeBSD? Thanks for your help, and to the coders out there, dont give up we need you, rely on you, and I cant speak for everyone but im sure I am, we APPRECIATE your hard work!

--------------------------------------------------
10/09/03 at 01:46:49  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
I should have added this to my post, sorry. If you are on a linux system and you have the LIBSTDC++.SO.5 file, can you please attach it to your post so I can have it? Maybe if I stick her in with my libs it will work. Or maybe it wont work. Or maybe it will but then ill have ten more dependency errors. heh. worth a shot im desperate. thanks!

--------------------------------------------------
10/09/03 at 03:41:40  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
Hah, I'm not sure you understand how an UNIX system works.

The .so files are dynamic libraries (the equivalent of DLL files for Windows), and the libstdc one is the standard C library, the one at the VERY CORE of the system. It's a system library, not a part of whatever binary distribution such as the HPB_bot. And obviously you can't just copy'n'paste it, it won't work.

Because most UNIX systems have fundamental differences, it's not uncommon that a library that runs on a system will NOT run on another one (actually, from the start it was the rule). That's why there's so much availability of source code for UNIX programs, so that the users can compile a binary out of it directly for their system. That's what you need to do with the HPB_bot and metamod if you want to have them to work with your version of the libstdc.so.

Of course, if you are running FreeBSD, you'll have trouble recompiling a library for Linux (unless you do a cross-compile, which is not easy to set up), so I suggest you fire up a Linux distro on a machine, download the source code for metamod and for the bot you need, download the SDK and put it somewhere too, and build the thing with fingers crossed. If you get error messages, start a new thread in the SDK forum and we'll be here to help.


--------------------------------------------------
10/09/03 at 09:58:30  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Well I know UNIX fairly well for someone who has only been using a computer a few years, as I am sure you can see from my website below my post here which is completely dedicated to FreeBSD/*NIX And its hosted and run all by me out of my living room. I love setting up different operating systems, servers and other stuff. I like *BSD a hundred times better then linux because IMHO not only is *BSD better in general as an OS, but its userbase isnt contaminated with little kids, packet monkeys, and script kiddies. Anyway, I learn on an as needed basis, that way I dont waste my brain activity or time on a bunch of crap i'll never actually need or want to implement. I knew that it was the equivalent of a windows DLL, I just didnt know it was the core library. And as I said I needed a specially compiled metamod.so file that was "hacked" that I got to work with FreeBSD. I got it in the help section of the adminmod site. So I assumed if I had this .so file, it was in fact *possible* If this .so file is in fact a core library like you suggest, then it is *completely* possible for me to find it and install it, and I will. I already have the base linux emulation up, and It has RPM installed on the FreeBSD box etc.. Its only now a matter of time. I already have metamod and AMX installed too. Thanks for your reply.

[modified on 10/09/03 at 09:56:07]

[modified on 10/09/03 at 09:58:30]
--------------------------------------------------
10/09/03 at 10:12:18  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Yeah I have it now, god google is my best friend. I deinstalled /usr/ports/emulators linux_base, and im reinstalling. They made an error with that port, I found this out via a forum. Lookie what My box is doing now.. Only a matter of time! hehehe


Receiving compat-libstdc++-6.2-2.9.0.14.i386.rpm (896167 bytes): 45%

--------------------------------------------------
10/09/03 at 13:48:09  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Here we go.. 
I Uninstalled /usr/ports/emulators/linux_base-6 and I installed /usr/ports/emulators/linux_base-8 in its place. That now gave me all the libraries I needed.

Now it loads, but then crashes. I tried changing the order of the dlls it loaded in liblist.gam for example I tried this:
gamedll "addons/metamod/dlls/metamod.dll"
gamedll_linux "addons/metamod/dlls/metamod_i386.s"
gamedll_linux "dlls/HPB_bot_i486.so"
gamedll "dlls\mp.dll"

Then I tried this:

gamedll_linux "dlls/HPB_bot_i486.so"
gamedll "dlls\mp.dll"
gamedll "addons/metamod/dlls/metamod.dll"
gamedll_linux "addons/metamod/dlls/metamod_i386.so"

Because i could have sworn I read somewhere that the order the dlls are loaded might be the problem. Maybe not, I dont know for sure, cant remember. Anyway its finding that LIBSTDC++.SO.5 fine now. But why is it crashing? So i added the -debug switch when i started the daemon, and heres the output of debug.log.



----------------------------------------------
CRASH: Thu Oct  9 16:38:12 EDT 2003
Start Line: ./hlds_i686 -game cstrike -debug
Core was generated by `hlds_i686'.
Program terminated with signal 11, Segmentation fault.
#0  0x0 in ?? ()
#0  0x0 in ?? ()           
#1  0x282c4734 in ?? ()    
#2  0x282a1e3c in ?? ()    
#3  0x645f6564 in ?? ()    
Cannot access memory at address 0x2070616d.
End of crash report        
----------------------------------------------

Thanks for your help, waiting your response.


--------------------------------------------------
10/09/03 at 14:24:02  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Hey you know what I just noticed?? With just:

gamedll_linux "dlls/HPB_bot_i486.so" < StinkyBobs edited .so
gamedll "dlls\mp.dll"

in my liblist.gam, It crashes.

With just:
gamedll "addons/metamod/dlls/metamod.dll"
gamedll_linux "addons/metamod/dlls/metamod_i386.so"

It works fine (but no bots of course)
Now heres the thing I just noticed. with All of this in my liblist.gam

gamedll "addons/metamod/dlls/metamod.dll"
gamedll_linux "addons/metamod/dlls/metamod_i386.so"
gamedll_linux "dlls/HPB_bot_i486.so" < StinkyBobs edited .so 
gamedll "dlls\mp.dll"

It starts up fine, doesnt complain about anything, the bots just dont load in. Anything Im missing? And whats mp.dll for? I notice instead of being dlls/mp.dll like the others, its dlls\mp.dll like a windows filesystem and mp.dll was not even in my original steam liblist.gam it was only in my counter strike 1.5 liblist.gam, do I need it anymore?

[modified on 10/09/03 at 14:24:02]
--------------------------------------------------
10/09/03 at 15:20:23  Reply by: Cheesemonster!!! (cheeseh(at)rcbot(dot)net)
--------------------------------------------------
(Repeats myself)

Ahhh!!! (Scream) :o

do NOT put TWO of the same 'gamedll*' lines in your liblist.gam, <b>just make it point to the bot DLL ONLY</b>. The whole point in HPB_Bot is to hook the MOD dll, so you cannot do this!! If you could do this then there would be no point botman wrecking his brain trying to get bots to work with mods.

[modified on 10/09/03 at 15:18:43]

[modified on 10/09/03 at 15:20:23]
--------------------------------------------------
10/09/03 at 15:30:36  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Im sorry, dont hate me im just trying to understand. If I only have, 

gamedll_linux "dlls/HPB_bot_i486.so" < StinkyBobs edited .so in my liblist.gam

And not the metamod dll also, wont that break metamod? And again I have to ask or I will never learn, do I need that mp.dll?

What do you mean by two of "the same" gamedll's?

I just tried it with just the bot dll stinkybob gave me and it dumped a core.

[modified on 10/09/03 at 15:25:46]

[modified on 10/09/03 at 15:30:36]
--------------------------------------------------
10/09/03 at 15:59:08  Reply by: Cheesemonster!!! (cheeseh(at)rcbot(dot)net)
--------------------------------------------------
QUOTE:
gamedll "addons/metamod/dlls/metamod.dll" 
gamedll_linux "addons/metamod/dlls/metamod_i386.so" 
gamedll_linux "dlls/HPB_bot_i486.so" < StinkyBobs edited .so 
gamedll "dlls\mp.dll" 




Seems like you've got two gamedll settings and two gamedll_linux settings doesn't it? That's certainly not healthy :(

[modified on 10/09/03 at 15:59:08]
--------------------------------------------------
10/09/03 at 16:53:28  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
Hmmm, as I see, you're still trying hard to get it to work with your Linux emulation. Which BSD are you running ? I know OpenBSD pretty well, but not too much of FreeBSD (they have not the same kernel at all ; whereas OpenBSD is based off the generic 386BSD/NetBSD kernel FreeBSD took its own way and dedicated its code to the x86 architecture, changing a lot of things).

I suppose you're aware that the Linux emulation on *BSDs is NOT perfect. It's a pretty damn good one though, but it's not exempt of bugs. Running a monster like a HL engine under emulation is itself a little tour de force, especially if you add weirdosities like third-party bots in an engine code that is NOT bot friendly at all (Steam and CS 1.6)

Do things in the right order! Does it work under plain old nunux ? Test and debug with whatever stupid penguin, and once it WORKS and once all the stuff is IRONED OUT you may envision to port it to the Linux emulation on BSD.


--------------------------------------------------
10/09/03 at 17:01:16  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Now I got this is my liblist.gam

gamedll_linux "addons/metamod/dlls/metamod_i386.so"
gamedll "addons/HPB_bot/dlls/HPB_bot_i486.so" <stinkybobs edited .so file

And it starts fine, no errors, but no bots either.. suggestions?

And I also did not see the post above this one but Ill answer it now, im running FreeBSD. I dont want a linux box, and you'd rather not know why, I can see the flames now. So skipping that battle, FreeBSD's linux emulation is wonderful i ran cs 1.3 1.4 and 1.5 flawlessly for years without any errors and thats with hpb_bot and admin mod installed.

[modified on 10/09/03 at 17:01:16]
--------------------------------------------------
10/09/03 at 16:57:39  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Shoot. I doubled that post because i didnt click the next page "6" And now i cant delete this i can only modify.. someone please delete it.

[modified on 10/09/03 at 16:57:39]
--------------------------------------------------
10/09/03 at 16:58:03  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
create an autoexec.cfg in the mod directory, and put this in:
code:

localinfo mm_gamedll "addons/HPB_bot/dlls/HPB_bot_i486.so"


It will tell metamod to load the bot DLL instead of the game DLL.


--------------------------------------------------
10/09/03 at 17:07:53  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Nope, now it dumps core. If i do as you just said what do i want to use in my liblist.gam file,

gamedll_linux "addons/metamod/dlls/metamod_i386.so"

or gamedll "addons/metamod/dlls/metamod_i386.so"

--------------------------------------------------
10/09/03 at 17:11:56  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
...

Now if i have that in my autoexec.cfg, and i have this
gamedll "addons/metamod/dlls/metamod_i386.so"
in my liblist.gam instead of this
gamedll_linux "addons/metamod/dlls/metamod_i386.so"

I get the followong funky ass error.

Host_Error: Couldn't get DLL API from X 
!
FATAL ERROR (shutting down): Host_Error: Couldn't get DLL API from X 
!

--------------------------------------------------
10/09/03 at 17:19:21  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
Yours is gamedll_linux. the gamedll one is only used on Windows machines.

If it coredumps, that's it doesn't work (c)(r)(tm) ;D

More seriously, now you're in big trouble for a non-coder, because you'll have to debug it yourself, using the source code and the stack dump.

First off, start your server with the "+developer 2" argument and when it crashes, post the console output and the error message, if any.

If it crashes just at the first second, then that's because there's a libc incompatibility between the two .so's, the metamod one and the bot one. Which libc.so version have they been linked against, each one ?
Another reason would be that it hasn't found the right game DLL. In any way, we'd need the console output.

[edited]wow, it's realtime. Just saw your error. This means that it hasn't found the right gameDLL to load. Check all your paths, check that you've installed metamod and the bot at the right location, and tell us which version exactly of each one you're using.

[EDITED AGAIN]hey no ! you need gamedll_linux ONLY. If you don't put gamedll_linux the server doesn't know which library to load and that's why it causes your 'from X' error !

[modified on 10/09/03 at 17:19:21]
--------------------------------------------------
10/09/03 at 17:17:58  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
ahh now im getting somewhere, thank you see i didnt know that. Ill keep you posted thanks.

--------------------------------------------------
10/09/03 at 17:24:01  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Ok now its all loading fine NO errors, but the bots just dont start.. Next suggestion! im almost there? why the hell arent the bastards starting? :)

[modified on 10/09/03 at 17:24:01]
--------------------------------------------------
10/09/03 at 17:26:11  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
are you certain the bot DLL is loaded ?

What happens if you type bot specific commands in the console ?

[modified on 10/09/03 at 17:26:11]
--------------------------------------------------
10/09/03 at 17:29:17  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Wait a second. Its loading fine no errors, but theres no bots.. You told me to ONLY use gamedll_linux because gamedll is JUST for windows right. But the other guy here yelled when i had two gamedll_linux lines.. Its loading right now but i have this in my liblist.gam

gamedll_linux "addons/metamod/dlls/metamod_i386.so"
gamedll_linux "addons/HPB_bot/dlls/HPB_bot_i486.so"

--------------------------------------------------
10/09/03 at 17:36:21  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
You haven't understood how the bot DLL works.

You only need ONE gamedll_stuff line in your liblist.gam, because the engine can load only ONE library at once.

Either you choose to load the metamod library, or you choose to load the bot library. In either case, you can't *natively* have both running, UNLESS you load metamod and you use the autoexec.cfg trick I told you. This tells the metamod library to load the bot library instead of loading the game library.

The loading chain is then as follows:
The engine, by reading the liblist.gam, loads the metamod library, WHICH ONE, by reading the autoexec.cfg, loads the bot library, WHICH ONE is internally set up to load the CS game library.

So, edit your liblist.gam and put your gamedll_linux and ************ONLY IT*************

And if you have your autoexec.cfg file set up like I told you to, that's the way to go for things to work.


--------------------------------------------------
10/09/03 at 17:57:14  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
I have just
gamedll_linux "addons/metamod/dlls/metamod_i386.so"
in my liblist.gam

then I have 
localinfo mm_gamedll "addons/HPB_bot/dlls/hpb_bot_i486.so"
in my autoexec.cfg

I see metamod load, and then the whole thing dumps a core. I guess its time to wait for someone to get a working version of that .so going for FreeBSD. Like I had to wait for one for 1.5 as well. I dont want to give up but jesus christ almost 48 hours. I do thank you all for your time, and you made me understand how this works now which I did only to a point. So I thank you for that. Im going to shoot at some walls.

*EDIT*

I just noticed your post about three up now, I never noticed it before Ill try that +developer2 plan and let you know. Thanks man for your help.

[modified on 10/09/03 at 17:48:23]

[modified on 10/09/03 at 17:57:14]
--------------------------------------------------
10/09/03 at 18:01:21  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Alright I started it with +developer2 and it just crashes after it loads metamod. Doesnt give any output at all.

--------------------------------------------------
10/09/03 at 18:05:48  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Hey to use +developer 2 I need to also be using debug mode right? Because when I try to enable debug mode, with or without +developer 2, it crashes. I get a GDB error.. I dont think I can friggin debug now either..

--------------------------------------------------
10/09/03 at 18:15:32  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
BLING..

---------------------------------------------
CRASH: Thu Oct  9 21:03:36 EDT 2003
Start Line: ./hlds_i686 -game cstrike -debug +developer 2
Core was generated by `hlds_i686'.
Program terminated with signal 11, Segmentation fault.
#0  0x0 in ?? ()
#0  0x0 in ?? ()
#1  0x282c58e5 in ?? ()
#2  0x20676e69 in ?? ()
Cannot access memory at address 0x7373694d.
End of crash report
----------------------------------------------

wtf?

--------------------------------------------------
10/09/03 at 19:38:17  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
You're not using the debug versions of the libraries, the ones that have been linked with debugging symbols enabled. The debugger can't know which address corresponds to which function. Get the debug libs for metamod and HPB_bot and start over...


--------------------------------------------------
10/09/03 at 22:55:57  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
looks like i've been gone for a while.......
mike,
try this.  
cd /usr/ports/emulators/linux_base-8
make install clean

then see how you fare....also, my binary is supposed to be used with metamod (maybe I should have renamed it) in the plugins.ini file.

also, i'm using FreeBSD 4.8 for my server.  if you have any other freebsd related half-life questions, feel free to ask.

Stinky

--------------------------------------------------
10/10/03 at 01:11:50  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
I can tell you are going to save my days, which is good, I already put close to 72 hours in this. And I really didnt want to give up! I already deinstalled linux_base and installed the linux_base-8 and that solved _a lot_ of the dependency errors I was getting previously like i thought it would. Now, I run it, I have metamod called from my liblist.gam, and im calling HPB_bot_i486.so from my autoexec.cfg.. It dumps core at that point after metamod loads for a few seconds. (prob right when its trying to load the .so bot file) but its YOUR binary you made so it should work right? Anyway I used gdb to debug the hlds_i686.core file and heres what it turned over..

Core was generated by `hlds_i686'.
Program terminated with signal 11, Segmentation fault.
/lib/libNoVersion.so.1: No such file or directory.
#0  0x0 in ?? ()

Thanks for your help!

--------------------------------------------------
10/10/03 at 01:26:17  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
HPB_bot: Plugin attaching..

I have bots. I call metamod from my liblist.gam, and I took that crap out of autoexec.cfg and I added the HPB bot plugin to the metamod plugins.ini file.

Thank you SO much. Your the best. hehehe. Now I just need waypoints. Thanks man! See what happens when someone comes around who knows FreeBSD and not linux. hehehe You saved my tail in ONE post. Go FreeBSD. Thanks all for your help.

[modified on 10/10/03 at 01:26:17]
--------------------------------------------------
10/10/03 at 01:29:03  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
God damnit. Could not connect, server is full. Its ignoring my MAX bots setting in HPB_bot.cfg Its filling the server with bots. What a slap in the face this is! Im so0o close! Now I gotta figure this out hahahaa. oh man.

--------------------------------------------------
10/10/03 at 01:35:25  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
I fixed this bug already. My HPB_bot plugin has a mistake in BotCreate(). Look for the thread "HPB as a metamod plugin" in the Bot Wish List forum, where I describe the fix.


--------------------------------------------------
10/10/03 at 01:50:08  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
I have max bots and min bots unset, and i just have 6 addbot lines in the HPB_bot.cfg file. its not filling now so i guess im ok?

[modified on 10/10/03 at 01:50:08]
--------------------------------------------------
10/10/03 at 02:15:28  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
SIGH.

I got the min and max bots disabled and I just have addbot lines in my config file.. That seems to be working for now until I can find a newer version of this bot/.so out. I can deal with that for now. But when the game starts, all the bots stay completely still, my team members dont move until I push up against them, and the enemy doesnt move until I am very close or I shoot them in the ass. Whatever comes first. They all stay at the damn spawn point. And when the map changes, bots dont get loaded. Any ideas?

[modified on 10/10/03 at 02:15:28]
--------------------------------------------------
10/10/03 at 04:10:04  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
My bad, they are running around now OK and bumping into shit like normal. Now whats the ideal way to fix this min bot max bot issue? Do I need to recompile the .so which probably isnt an option for me because of all the crap I already went through and thats with stinkybobs binary as it is! Once I fix the min bot max bot issue, this thread is CLOSED. :) Thanks for all your help so far, and hopefully the help ill get to boost past this final barrier.

[modified on 10/10/03 at 04:10:04]
--------------------------------------------------
10/10/03 at 09:46:46  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
There is a bug with the HPB_bot that makes it stuck on some CS maps. The reason is that those maps (de_dust and de_dust2 do this) initialize the player entities with angles way out of bounds (for example, I've found that players often have a 500°+ view angle when they first spawn in CS, UNTIL they move their crosshair. The bots are very affected by this, and stand still until something new forces them to change their view angles (like a player shooting them in the butt).

To fix this, you need to wrap the bot's v.angles and v.v_angle in BotReset(), so that it is called when bots are spawning. If you want some hardcore protection against this bug, you can put this fix in StartFrame, by cycling through all the bots and wrapping all their angles.

Have a look in this forum for my WrapAngles() function.


--------------------------------------------------
10/10/03 at 12:33:13  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Naw man I wish it wasnt for me, but programming is _crazy_ I give you guys a lot of credit I am HORRIBLE with numbers and programming has a lot to do with digits... I can do a lot with PHP, MYSQL, and enough perl and shell scripting to let me be one HELL of a lazy ass admin. But I simply cannot program. I have an online library (just for me cause of copyright issues.. lot of people threatened to sue my ass when I had it on my site.) Anyway I have this huge library and I read and read but its just not for me. Ill have to wait until you guys kick out a new version that I can get working with FreeBSD linux emulation. I just woke up now at 3pm mind you cause I was messing with the damn bots all night/morning. I downloaded some waypoints and uploaded them to the server and spent a lot of time on them. But I appreciate all the help I got from you guys. It will only get better from this point on and backed up to CDROM as I go along. Anyway as I was just saying, I just woke up and the bots seem to still be running fine.. Thanks all.

--------------------------------------------------
10/10/03 at 16:44:11  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
Anyone have any idea why these things are happening? I disabled min and max bots because of that bug. I then use HPB_bot.cfg to 
add 12 custom bots. When the server first starts it seems fine. But after a while, the bot count seems to drop over time until the server is empty. And if I change maps myself, bots dont get loaded at all? The server stays empty. Is it because I have to have MIN MAX bots disabled because of that bug or what?

[modified on 10/10/03 at 16:44:11]
--------------------------------------------------
10/10/03 at 17:12:02  Reply by: PM (pm@racc-ai.com)
--------------------------------------------------
Why don't you just put in the 2 fixes I told you about ?

If 'I suck at coding' had been the excuse for me not to start learning how to code at all, I wouldn't have known what I do know now. Same for everyone... don't be shy.

One thing that might decide you is that you MUST know that ANY respectable Unix user HAS to know how to hack C code at some point. If you don't, whala, I don't know what you're trying to fake with your BSD...



[P.S. nothing aggressive, just bumping you out of your laziness ;) ]


[modified on 10/10/03 at 17:12:02]
--------------------------------------------------
10/10/03 at 18:09:36  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
You know something? Your 100% right, maybe im just looking down at myself rather then up, or I just dont THINK I could do it so it's easier for me not to try at all.. Thanks for the kick in the ass. I am going to give it a go and im not one to give up either. Maybe Ill catch onto it and someday wish I could thank you for the nudge you gave me that got me started. Thanks mate.

[modified on 10/10/03 at 18:09:36]
--------------------------------------------------
10/10/03 at 18:43:38  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
i'll try to recompile the linux bots with PMB's code.  (cause that's what I used in the first place).....course I do suck at coding...it's just the compiling and figuring out dependencies that I am good at.....

Stinky

--------------------------------------------------
10/10/03 at 18:45:26  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
here's one problem, mike....I don't believe you can compile the binary under FreeBSD.  I've never had success at it....Plus I doubt that linux would want to execute a BSD binary.  I need to rebuild my linux box so I can rebuild this code.

Stinky

--------------------------------------------------
10/10/03 at 23:06:46  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
If you did that for me I would be very grateful. You can email it to me or drop it in my anonymous FTP server. ftp.unixhideout.com but I would rather you email it so I get it directly. You should hang out at my website or in IRC. You seem mad cool. My site is all about *NIX security, and other news and trying to get people to use *NIX. You could even be a part of it if you wanted. Do you hang out in any IRC networks? Come stop by irc.unixhideout.com #unixhideout my nick is mike. Ill be waiting for that binary man thanks. I need a linux box. The only linux I will even touch is gentoo, slackware, or debian. The rest of the linux distributions just try to outbetter each other and make themselves suck in the process. I cant bother to have four computers anyway. Three is enough updating and patching for me.. I got my FreeBSD server, (unixhideout.com) and I got a second FreeBSD machine that does nothing except serve DNS requests for my lan, and it backs up server 1 via cvsup every night. Then I have to have my windows XP box for games. :)

*
For the trigger happy moderators if any even exist, I dont spam and I dont consider this spam, this guy is cool as hell and this board is the only contact I have with him. All apologies.
*

[modified on 10/10/03 at 23:06:46]
--------------------------------------------------
10/11/03 at 19:44:38  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
i uploaded it to my geocities web site.

http://www.geocities.com/evanandfaith
then use the hpbbot link.
I installed redhat 9 under vmware on my windows box to come up with this one....my bsd box is dead....hardware failure....

--------------------------------------------------
10/11/03 at 22:34:13  Reply by: mike (mike[AT]unixhideout.com)
--------------------------------------------------
I sure appreciate it but the server is still filling up with bots. I removed all the addbot lines from HPB_bot.cfg, and I have min 8 bots max 16 and my server will handle 32 max players. But it fills up with 32 bots. :( Is there something I am overlooking?

[modified on 10/11/03 at 22:34:13]
--------------------------------------------------
10/12/03 at 13:07:28  Reply by: stinkybob (evan@mcdaniel.sytes.net)
--------------------------------------------------
there is a problem with the minbot and maxbot with that code.....i'm not a programmer so not sure where to look..comment out the min and max cvars and place the addbots in the bottom.

Stinky

--------------------------------------------------
10/12/03 at 13:12:38  Reply by: Cheesemonster!!! (cheeseh(at)rcbot(dot)net)
--------------------------------------------------
Just add something in addbot to return and ignore adding a bot if num_bots >= max_bots

